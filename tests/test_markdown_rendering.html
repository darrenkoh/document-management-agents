<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Rendering Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.0/lib/marked.umd.js"></script>
    <style>
        body { padding: 20px; }
        .markdown-preview {
            line-height: 1.6;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .markdown-preview h1, .markdown-preview h2, .markdown-preview h3 {
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
        }
        .markdown-preview table {
            width: 100%;
            margin-bottom: 1rem;
            border-collapse: collapse;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .markdown-preview th, .markdown-preview td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .markdown-preview th {
            background: #f8f9fa;
            font-weight: 600;
        }
        .markdown-preview tr:nth-child(even) {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Markdown Rendering Test</h1>

        <div class="row">
            <div class="col-md-6">
                <h3>Raw Content (with DeepSeek-OCR metadata)</h3>
                <pre id="raw-content" class="border p-3 bg-light" style="font-size: 0.8rem;"></pre>
            </div>
            <div class="col-md-6">
                <h3>Rendered Markdown</h3>
                <div class="markdown-preview" id="rendered-content"></div>
            </div>
        </div>
    </div>

    <script>
        // Sample DeepSeek-OCR content with metadata
        const sampleContent = `<|ref|>text<|/ref|><|det|>[[90, 13, 235, 42]]<|/det|>
BTIG,LLC 600 Montgomery Street 6th Floor San Francisco,CA 94111-2708

<|ref|>text<|/ref|><|det|>[[90, 129, 274, 160]]<|/det|>
DARREN KOH 3773 BRANDING IRON PL DUBLIN CA 94568- 7289

<|ref|>title<|/ref|><|det|>[[347, 281, 630, 310]]<|/det|>
# YOUR TOTAL ACCOUNT VALUE IS: $260.12 AS OF 06/30/2011

<|ref|>table<|/ref|><|det|>[[67, 355, 555, 444]]<|/det|>

<table><tr><td colspan="2">Your Account At A Glance</td></tr><tr><td>Opening Value on 04/01/2011</td><td>$261.30</td></tr><tr><td>Contributions</td><td>$0.00</td></tr><tr><td>Investment Gain/(Loss)</td><td>($1.18)</td></tr><tr><td>Total Account Value on 06/30/2011</td><td>$260.12</td></tr></table>`;

        function cleanAndRenderMarkdown(content) {
            // Remove DeepSeek-OCR reference tags and bounding box data
            const cleaned = content
                .replace(/<\|ref\|>[^<]*<\|\/ref\|>/g, '')  // Remove reference tags
                .replace(/<\|det\|>[^<]*<\|\/det\|>/g, '')  // Remove bounding box data
                .replace(/<\|image\|>[^<]*<\|\/image\|>/g, '')  // Remove image tags
                .replace(/\n{3,}/g, '\n\n')  // Clean up excessive newlines
                .trim();

            // Render markdown using marked
            const rendered = marked.parse(cleaned, {
                breaks: true,
                gfm: true
            });

            return { cleaned, rendered };
        }

        // Render content on page load
        document.addEventListener('DOMContentLoaded', function() {
            const { cleaned, rendered } = cleanAndRenderMarkdown(sampleContent);

            document.getElementById('raw-content').textContent = sampleContent;
            document.getElementById('rendered-content').innerHTML = rendered;

            console.log('Original:', sampleContent);
            console.log('Cleaned:', cleaned);
            console.log('Rendered:', rendered);
        });
    </script>
</body>
</html>
